<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png?v=6.3.0">


  <link rel="mask-icon" href="/icons/logo.svg?v=6.3.0" color="#222">


  <link rel="manifest" href="/icons/manifest.json">


  <meta name="msapplication-config" content="/icons/browserconfig.xml" />







<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.3.0',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>


  




  <meta name="description" content="暂未完成的文章，文中介绍了CoreML，TensorFlow和Keras的安装，以及TensorFlow在iOS上的使用，包含一个小的demo，LibTensorFlowForiOSSwift，地址在github：https://github.com/tobedefined/LibTensorFlowForiOSSwift 。">
<meta name="keywords" content="iOS,CoreML,TensorFlow,Keras,GitHub">
<meta property="og:type" content="article">
<meta property="og:title" content="CoreML &amp; TensorFlow For iOS">
<meta property="og:url" content="http://tbd.tech/2017/07/14/iOS/17071401.CoreML & TensorFlow For iOS/index/index.html">
<meta property="og:site_name" content="　 TBD&#39;s Blog 　">
<meta property="og:description" content="暂未完成的文章，文中介绍了CoreML，TensorFlow和Keras的安装，以及TensorFlow在iOS上的使用，包含一个小的demo，LibTensorFlowForiOSSwift，地址在github：https://github.com/tobedefined/LibTensorFlowForiOSSwift 。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-11-22T14:24:32.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CoreML &amp; TensorFlow For iOS">
<meta name="twitter:description" content="暂未完成的文章，文中介绍了CoreML，TensorFlow和Keras的安装，以及TensorFlow在iOS上的使用，包含一个小的demo，LibTensorFlowForiOSSwift，地址在github：https://github.com/tobedefined/LibTensorFlowForiOSSwift 。">






  <link rel="canonical" href="http://tbd.tech/2017/07/14/iOS/17071401.CoreML & TensorFlow For iOS/index/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>CoreML & TensorFlow For iOS | 　 TBD's Blog 　</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">　 TBD's Blog 　</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">To Be Defined</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-my-gitbook">
    <a href="/gitbook/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-bookmark"></i> <br />My GitBook</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://tbd.tech/2017/07/14/iOS/17071401.CoreML & TensorFlow For iOS/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="TBD">
      <meta itemprop="description" content="一个梦想着改变世界的小程序猿……">
      <meta itemprop="image" content="/avatars/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="　 TBD's Blog 　">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CoreML & TensorFlow For iOS
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-07-14 20:44:55" itemprop="dateCreated datePublished" datetime="2017-07-14T20:44:55+00:00">2017-07-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-11-22 14:24:32" itemprop="dateModified" datetime="2019-11-22T14:24:32+00:00">2019-11-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/iOS/" itemprop="url" rel="index"><span itemprop="name">iOS</span></a></span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/07/14/iOS/17071401.CoreML & TensorFlow For iOS/index/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count hc-comment-count" data-xid="2017/07/14/iOS/17071401.CoreML & TensorFlow For iOS/index/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          
              <div class="post-description">暂未完成的文章，文中介绍了CoreML，TensorFlow和Keras的安装，以及TensorFlow在iOS上的使用，包含一个小的demo，LibTensorFlowForiOSSwift，地址在github：https://github.com/tobedefined/LibTensorFlowForiOSSwift 。</div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><a href="https://github.com/tobedefined/LibTensorFlowForiOSSwift" target="_blank" rel="noopener">TensorFlowForIOS Demo</a></p>
<h3 id="CoreML-Tools"><a href="#CoreML-Tools" class="headerlink" title="CoreML Tools"></a>CoreML Tools</h3><p><a href="https://developer.apple.com/machine-learning/" target="_blank" rel="noopener">官网</a></p>
<p><a href="https://pypi.python.org/pypi/coremltools" target="_blank" rel="noopener">下载网站</a></p>
<p><a href="http://pythonhosted.org/coremltools/" target="_blank" rel="noopener">文档</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install -U coremltools</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">pip install -U coremltools --upgrade --ignore-installed six</span><br></pre></td></tr></table></figure>
<h3 id="TensorFlow"><a href="#TensorFlow" class="headerlink" title="TensorFlow"></a>TensorFlow</h3><p><a href="https://www.tensorflow.org/install/install_mac" target="_blank" rel="noopener">安装文档</a></p>
<blockquote>
<p>环境</p>
<ul>
<li><code>Python 2.7</code></li>
<li><code>Python 3.3+</code></li>
</ul>
<p>这里采用 <code>Installing with native pip</code></p>
</blockquote>
<ul>
<li>检查pip版本</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip -V  <span class="comment"># for Python 2.7</span></span><br><span class="line">pip3 -V <span class="comment"># for Python 3.n</span></span><br></pre></td></tr></table></figure>
<ul>
<li>升级pip版本和six版本（建议pip版本&gt;=8.1）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo easy_install --upgrade pip</span><br><span class="line">sudo easy_install --upgrade six</span><br></pre></td></tr></table></figure>
<ul>
<li>pip安装TensorFlow</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install tensorflow</span><br><span class="line">pip install tensorflow</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ pip3 install tensorflow</span><br><span class="line">Collecting tensorflow</span><br><span class="line">  Downloading tensorflow-1.2.1-cp35-cp35m-macosx_10_11_x86_64.whl (33.6MB)</span><br><span class="line">    100% |████████████████████████████████| 33.6MB 26kB/s</span><br><span class="line">Collecting werkzeug&gt;=0.11.10 (from tensorflow)</span><br><span class="line">  Using cached Werkzeug-0.12.2-py2.py3-none-any.whl</span><br><span class="line">Collecting wheel&gt;=0.26 (from tensorflow)</span><br><span class="line">  Downloading wheel-0.29.0-py2.py3-none-any.whl (66kB)</span><br><span class="line">    100% |████████████████████████████████| 71kB 65kB/s</span><br><span class="line">Collecting html5lib==0.9999999 (from tensorflow)</span><br><span class="line">  Using cached html5lib-0.9999999.tar.gz</span><br><span class="line">Requirement already satisfied: numpy&gt;=1.11.0 <span class="keyword">in</span> /Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages (from tensorflow)</span><br><span class="line">Collecting protobuf&gt;=3.2.0 (from tensorflow)</span><br><span class="line">Collecting backports.weakref==1.0rc1 (from tensorflow)</span><br><span class="line">  Using cached backports.weakref-1.0rc1-py3-none-any.whl</span><br><span class="line">Requirement already satisfied: six&gt;=1.10.0 <span class="keyword">in</span> /Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages (from tensorflow)</span><br><span class="line">Collecting bleach==1.5.0 (from tensorflow)</span><br><span class="line">  Using cached bleach-1.5.0-py2.py3-none-any.whl</span><br><span class="line">Collecting markdown&gt;=2.6.8 (from tensorflow)</span><br><span class="line">  Using cached Markdown-2.6.8.tar.gz</span><br><span class="line">Requirement already satisfied: setuptools <span class="keyword">in</span> /Library/Frameworks/Python.framework/Versions/3.5/lib/python3.5/site-packages (from protobuf&gt;=3.2.0-&gt;tensorflow)</span><br><span class="line">Installing collected packages: werkzeug, wheel, html5lib, protobuf, backports.weakref, bleach, markdown, tensorflow</span><br><span class="line">  Running setup.py install <span class="keyword">for</span> html5lib ... <span class="keyword">done</span></span><br><span class="line">  Running setup.py install <span class="keyword">for</span> markdown ... <span class="keyword">done</span></span><br><span class="line">Successfully installed backports.weakref-1.0rc1 bleach-1.5.0 html5lib-0.9999999 markdown-2.6.8 protobuf-3.3.0 tensorflow-1.2.1 werkzeug-0.12.2 wheel-0.29.0</span><br></pre></td></tr></table></figure>
<ul>
<li>(可选)如果pip安装TensorFlow失败尝试以下命令</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pip  install --upgrade tfBinaryURL   <span class="comment"># Python 2.7</span></span><br><span class="line">sudo pip3 install --upgrade tfBinaryURL   <span class="comment"># Python 3.n</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><em>tfBinaryURL</em>是指TensorFlow Python package的URL，<a href="https://www.tensorflow.org/install/install_mac#the_url_of_the_tensorflow_python_package" target="_blank" rel="noopener">查找合适的下载地址</a><br>例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; sudo pip3 install --upgrade \</span><br><span class="line">&gt; https://storage.googleapis.com/tensorflow/mac/cpu/tensorflow-1.2.1-py2-none-any.whl </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>验证安装正确</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ Python <span class="keyword">or</span> Python3</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>hello = tf.constant(<span class="string">'Hello, TensorFlow!'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sess = tf.Session()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(sess.run(hello))</span><br></pre></td></tr></table></figure>
<h3 id="Keras"><a href="#Keras" class="headerlink" title="Keras"></a>Keras</h3><p><a href="https://github.com/fchollet/keras" target="_blank" rel="noopener">github</a></p>
<ul>
<li>To install Keras, cd to the Keras folder and run the install command:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<ul>
<li>You can also install Keras from PyPI:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install keras</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip3 install keras</span><br><span class="line">Password:</span><br><span class="line">The directory <span class="string">'/Users/shaoweinan154/Library/Caches/pip/http'</span> or its parent directory is not owned by the current user and the cache has been disabled. Please check the permissions and owner of that directory. If executing pip with sudo, you may want sudo<span class="string">'s -H flag.</span></span><br><span class="line"><span class="string">The directory '</span>/Users/shaoweinan154/Library/Caches/pip<span class="string">' or its parent directory is not owned by the current user and caching wheels has been disabled. check the permissions and owner of that directory. If executing pip with sudo, you may want sudo'</span>s -H flag.</span><br><span class="line">Collecting keras</span><br><span class="line">  Downloading Keras-2.0.6.tar.gz (228kB)</span><br><span class="line">    100% |████████████████████████████████| 235kB 170kB/s</span><br><span class="line">Collecting theano (from keras)</span><br><span class="line">  Downloading Theano-0.9.0.tar.gz (3.1MB)</span><br><span class="line">    100% |████████████████████████████████| 3.1MB 86kB/s</span><br><span class="line">Collecting pyyaml (from keras)</span><br><span class="line">  Downloading PyYAML-3.12.tar.gz (253kB)</span><br><span class="line">    100% |████████████████████████████████| 256kB 70kB/s</span><br><span class="line">Collecting six (from keras)</span><br><span class="line">  Downloading six-1.10.0-py2.py3-none-any.whl</span><br><span class="line">Collecting numpy&gt;=1.9.1 (from theano-&gt;keras)</span><br><span class="line">  Downloading numpy-1.13.1-cp35-cp35m-macosx_10_6_intel.macosx_10_9_intel.macosx_10_9_x86_64.macosx_10_10_intel.macosx_10_10_x86_64.whl (4.5MB)</span><br><span class="line">    100% |████████████████████████████████| 4.5MB 59kB/s</span><br><span class="line">Collecting scipy&gt;=0.14 (from theano-&gt;keras)</span><br><span class="line">  Downloading scipy-0.19.1-cp35-cp35m-macosx_10_6_intel.macosx_10_9_intel.macosx_10_9_x86_64.macosx_10_10_intel.macosx_10_10_x86_64.whl (16.1MB)</span><br><span class="line">    100% |████████████████████████████████| 16.1MB 30kB/s</span><br><span class="line">Installing collected packages: numpy, scipy, six, theano, pyyaml, keras</span><br><span class="line">  Running setup.py install <span class="keyword">for</span> theano ... <span class="keyword">done</span></span><br><span class="line">  Running setup.py install <span class="keyword">for</span> pyyaml ... <span class="keyword">done</span></span><br><span class="line">  Running setup.py install <span class="keyword">for</span> keras ... <span class="keyword">done</span></span><br><span class="line">Successfully installed keras-2.0.6 numpy-1.13.1 pyyaml-3.12 scipy-0.19.1 six-1.10.0 theano-0.9.0</span><br></pre></td></tr></table></figure>
<h3 id="编译TensorFlow-For-iOS"><a href="#编译TensorFlow-For-iOS" class="headerlink" title="编译TensorFlow For iOS"></a>编译TensorFlow For iOS</h3><blockquote>
<p><a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<ul>
<li>Install <code>XCode 7.3</code> or more recent.</li>
</ul>
<ul>
<li><p>下载TensorFlow到项目根目录并编译</p>
<blockquote>
<p>在编译源文件之前, 要先进行修改TensorFlow Kernel的一些文件（版本 &lt;= 1.2.1）</p>
<p>kernel path: <code>tensorflow/tensorflow/core/kernels</code></p>
</blockquote>
<ul>
<li><p><code>cwise_op_add_1.cc</code></p>
<blockquote>
<p>源码:</p>
</blockquote>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tensorflow/core/kernels/cwise_ops_common.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tensorflow &#123;</span><br><span class="line">REGISTER5(BinaryOp, CPU, <span class="string">"Add"</span>, functor::add, <span class="keyword">float</span>, Eigen::half, <span class="keyword">double</span>, int32,</span><br><span class="line">          int64);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> TENSORFLOW_USE_SYCL</span></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>修改为:</p>
</blockquote>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tensorflow/core/kernels/cwise_ops_common.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tensorflow &#123;</span><br><span class="line">REGISTER5(BinaryOp, CPU, <span class="string">"Add"</span>, functor::add, <span class="keyword">float</span>, Eigen::half, <span class="keyword">double</span>, int32,</span><br><span class="line">          int64);</span><br><span class="line"></span><br><span class="line"><span class="comment">// line 21 insert this code</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__ANDROID_TYPES_SLIM__)</span></span><br><span class="line">REGISTER(BinaryOp, CPU, <span class="string">"Add"</span>, functor::add, int32);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// __ANDROID_TYPES_SLIM__</span></span></span><br><span class="line"><span class="comment">// insert end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> TENSORFLOW_USE_SYCL</span></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>cwise_op_less.cc</code></p>
<blockquote>
<p>源码:</p>
</blockquote>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tensorflow/core/kernels/cwise_ops_common.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tensorflow &#123;</span><br><span class="line">REGISTER8(BinaryOp, CPU, <span class="string">"Less"</span>, functor::less, <span class="keyword">float</span>, Eigen::half, <span class="keyword">double</span>,</span><br><span class="line">          int32, int64, uint8, int8, int16);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> GOOGLE_CUDA</span></span><br><span class="line">REGISTER7(BinaryOp, GPU, <span class="string">"Less"</span>, functor::less, <span class="keyword">float</span>, Eigen::half, <span class="keyword">double</span>,</span><br><span class="line">          int64, uint8, int8, int16);</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>修改为:</p>
</blockquote>
  <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"tensorflow/core/kernels/cwise_ops_common.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> tensorflow &#123;</span><br><span class="line">REGISTER8(BinaryOp, CPU, <span class="string">"Less"</span>, functor::less, <span class="keyword">float</span>, Eigen::half, <span class="keyword">double</span>,</span><br><span class="line">          int32, int64, uint8, int8, int16);</span><br><span class="line"></span><br><span class="line"><span class="comment">// line 21 insert this code</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__ANDROID_TYPES_SLIM__)</span></span><br><span class="line">REGISTER(BinaryOp, CPU, <span class="string">"Less"</span>, functor::less, int32);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span>  <span class="comment">// __ANDROID_TYPES_SLIM__</span></span></span><br><span class="line"><span class="comment">// insert end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> GOOGLE_CUDA</span></span><br><span class="line">REGISTER7(BinaryOp, GPU, <span class="string">"Less"</span>, functor::less, <span class="keyword">float</span>, Eigen::half, <span class="keyword">double</span>,</span><br><span class="line">          int64, uint8, int8, int16);</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>install the <code>command-line tools</code> using xcode-select</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcode-select --install</span><br></pre></td></tr></table></figure>
</li>
<li><p>install <a href="https://en.wikipedia.org/wiki/Automake" target="_blank" rel="noopener"><code>automake</code></a>/<a href="https://en.wikipedia.org/wiki/GNU_Libtool" target="_blank" rel="noopener"><code>libtool</code></a>:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install automake</span><br><span class="line">brew install libtool</span><br></pre></td></tr></table></figure>
</li>
<li><p>Building all at once</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorflow/contrib/makefile/build_all_ios.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="项目导入TensorFlow"><a href="#项目导入TensorFlow" class="headerlink" title="项目导入TensorFlow"></a>项目导入TensorFlow</h3><ul>
<li><p>下载TensorFlow到项目根目录并编译</p>
</li>
<li><p><code>libtensorflow-core.a</code></p>
<ul>
<li><code>Other Link Flags</code> 中加入 <code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/gen/lib/libtensorflow-core.a</code></li>
<li><code>Library Search Paths</code> 中加入 <code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/gen/lib</code></li>
</ul>
</li>
<li><p><code>libprotobuf.a &amp; libprotobuf-lite.a</code></p>
<ul>
<li><code>Build Phases | Link Binary With Libraries</code> 中加入 <code>libprotobuf.a &amp; libprotobuf-lite.a</code> (path: <code>tensorflow/tensorflow/contrib/makefile/gen/protobuf_ios/lib/</code>)</li>
<li><code>Library Search Paths</code> 中加入 <code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/gen/protobuf_ios/lib</code> </li>
</ul>
</li>
<li><p><code>Header Search Paths</code>中加入</p>
<ul>
<li><code>$(SRCROOT)/tensorflow/</code></li>
<li><code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/downloads/protobuf/src/</code></li>
<li><code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/downloads</code></li>
<li><code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/downloads/eigen</code></li>
<li><code>$(SRCROOT)/tensorflow/tensorflow/contrib/makefile/gen/proto</code></li>
</ul>
</li>
<li><p><code>Other Link Flags</code> 中加入 <code>-force_load</code></p>
</li>
<li><p><code>Build Phases | Link Binary With Libraries</code> 中加入 <code>Accelerate.framework</code></p>
</li>
<li><p><code>C++ Language Dialect</code> 设置为 <code>GNU++11</code> or <code>GNU++14</code></p>
</li>
<li><p><code>C++ Standard Library</code> 设置为 <code>libc++</code></p>
</li>
<li><p><code>Enable Bitcode</code> 设置为 <code>No</code></p>
</li>
<li><p>删除所有使用的 <code>-all_load</code> ，替换为 <code>-ObjC</code></p>
<blockquote>
<p>Remove any use of the <code>-all_load</code> flag in your project. The protocol buffers libraries (full and lite versions) contain duplicate symbols, and the <code>-all_load</code> flag will cause these duplicates to become link errors. If you were using <code>-all_load</code> to avoid issues with Objective-C categories in static libraries, you may be able to replace it with the <code>-ObjC</code> flag.</p>
</blockquote>
</li>
<li><p>忽略TensorFlow编译的警告：</p>
<ul>
<li>在<code>Other C Flags</code> &amp; <code>Other C++ Flags</code>中加入<code>-isystem $(SRCROOT)/tensorflow</code></li>
</ul>
</li>
</ul>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><p>编译TensorFlow：</p>
<blockquote>
<p><a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile" target="_blank" rel="noopener">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/makefile</a></p>
</blockquote>
</li>
<li><p>修改Kernels错误：</p>
<blockquote>
<p><a href="https://github.com/h4x3rotab/emoji-tf-ios/blob/master/README.md" target="_blank" rel="noopener">https://github.com/h4x3rotab/emoji-tf-ios/blob/master/README.md</a></p>
</blockquote>
</li>
<li><p>项目中导入TensorFlow静态库：</p>
<blockquote>
<p><a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/ios/README.md" target="_blank" rel="noopener">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/ios/README.md</a></p>
</blockquote>
</li>
<li><p>忽略TensorFlow警告：</p>
<blockquote>
<p><a href="https://clang.llvm.org/docs/UsersManual.html%23id27" target="_blank" rel="noopener">https://clang.llvm.org/docs/UsersManual.html%23id27</a></p>
</blockquote>
</li>
</ul>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"># iOS</a>
          
            <a href="/tags/CoreML/" rel="tag"># CoreML</a>
          
            <a href="/tags/TensorFlow/" rel="tag"># TensorFlow</a>
          
            <a href="/tags/Keras/" rel="tag"># Keras</a>
          
            <a href="/tags/GitHub/" rel="tag"># GitHub</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/07/05/iOS/17070502.在SDWebImage基础上添加UIImageView扩展使其可以缓存/index/" rel="next" title="在SDWebImage基础上添加UIImageView扩展使其可以缓存">
                <i class="fa fa-chevron-left"></i> 在SDWebImage基础上添加UIImageView扩展使其可以缓存
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/07/18/iOS/17071801.TSegmentedView/index/" rel="prev" title="TSegmentedView">
                TSegmentedView <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="hypercomments_widget"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/avatars/avatar.png"
                alt="TBD" />
            
              <p class="site-author-name" itemprop="name">TBD</p>
              <p class="site-description motion-element" itemprop="description">一个梦想着改变世界的小程序猿……</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">25</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/tobedefined" target="_blank" title="GitHub"><i class="fa fa-fw fa-globe"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#CoreML-Tools"><span class="nav-number">1.</span> <span class="nav-text">CoreML Tools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TensorFlow"><span class="nav-number">2.</span> <span class="nav-text">TensorFlow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Keras"><span class="nav-number">3.</span> <span class="nav-text">Keras</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译TensorFlow-For-iOS"><span class="nav-number">4.</span> <span class="nav-text">编译TensorFlow For iOS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#项目导入TensorFlow"><span class="nav-number">5.</span> <span class="nav-text">项目导入TensorFlow</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考文档"><span class="nav-number">6.</span> <span class="nav-text">参考文档</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">TBD</span>

  

  
</div>




  <div class="powered-by">Hosted by <a class="theme-link" target="_blank" href="https://pages.coding.net/">Coding Pages</a> And <a class="theme-link" target="_blank" href="https://pages.github.com/">GitHub Pages</a>, Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 93352, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		
		_hcwp.push({widget:"Stream", widget_id: 93352, xid: "2017/07/14/iOS/17071401.CoreML & TensorFlow For iOS/index/"});
		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/93352/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
